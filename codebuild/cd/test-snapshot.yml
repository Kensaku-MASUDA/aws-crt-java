version: 0.2
#this buildspec assumes the ubuntu 14.04 trusty image
# This job is responsible for artifacting the JAR which will have all of the other shared libs stuffed
# into it once all platforms are built and artifacted
phases:
  install:
    commands:
      - sudo add-apt-repository ppa:openjdk-r/ppa
      - sudo apt-get update -y
      - sudo apt-get install openjdk-8-jdk-headless maven -y -f

  pre-build:
    commands:
      - pushd aws-crt-java
      - export CRT_VERSION=$(git describe --abbrev=0 | sed -e s/^v//)
      - popd

  build:
    commands:
      - echo Build started on `date`
      # Verify that the package can be found in the snapshot repo
      - mvn -B dependency:get -DremoteRepositories=https://oss.sonatype.org/content/repositories/snapshots -Dartifact=software.amazon.awssdk.crt:aws-crt:$CRT_VERSION-SNAPSHOT -Dtransitive=false
      
  post_build:
    commands:
      - echo Build completed on `date`

cache:
  paths:
    - '/root/.m2/**/*'
